<!--
=========================================================
* Paper Dashboard 2 - v2.0.1
=========================================================

* Product Page: https://www.creative-tim.com/product/paper-dashboard-2
* Copyright 2020 Creative Tim (https://www.creative-tim.com)

Coded by www.creative-tim.com

 =========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!doctype html>
<html lang="en">
  <style>
    .hide {
      display: none;
    }
    .show {
      display: block;
    }
  </style>

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Jounral Database Slurp  
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
  <!-- CSS Files -->
  <link href="./assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="./assets/css/paper-dashboard.css?v=2.0.1" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="./assets/demo/demo.css" rel="stylesheet" />
</head>

<body class="">
  <div class="wrapper" style =" padding: 35px; background-color:powderblue;">
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <h3>Journal Database Slurp</h3>
          </div>
        </div>
      </div>

      <div class="content">

      <div class="row">
        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="card card-stats">
            <div class="card-body ">
              <div class="row">
                <div class="col-5 col-md-4">
                  <div class="icon-big text-center icon-warning">
                    <i class="nc-icon nc-watch-time text-warning"></i>
                  </div>
                </div>
                <div class="col-7 col-md-8">
                  <div class="numbers">
                    <p class="card-category">Execution Time</p>
                    <p id = "timer" class="card-title"> m  s<p>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer ">
              <hr>
              
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="card card-stats">
            <div class="card-body ">
              <div class="row">
                <div class="col-5 col-md-4">
                  <div class="icon-big text-center icon-warning">
                    <i class="nc-icon nc-badge text-success"></i>
                  </div>
                </div>
                <div class="col-7 col-md-8">
                  <div class="numbers">
                    <p class="card-category"># of Items Skipped</p>
                    <p id = "numSkip" class="card-title">0<p>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer ">
              <hr>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="card card-stats">
            <div class="card-body ">
              <div class="row">
                <div class="col-5 col-md-4">
                  <div class="icon-big text-center icon-warning">
                    <i class="nc-icon nc-tap-01 text-danger"></i>
                  </div> 
                </div>
                <div class="col-7 col-md-8">
                  <div class="numbers">
                    <p class="card-category"># of Items Updated</p>
                    <p id = "numUpdate" class="card-title">0<p>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer ">
              <hr>
            
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="card card-stats">
            <div class="card-body ">
              <div class="row">
                <div class="col-5 col-md-4">
                  <div class="icon-big text-center icon-warning">
                    <i class="nc-icon nc-bank text-primary"></i>
                  </div>
                </div>
                <div class="col-7 col-md-8">
                  <div class="numbers">
                    <p class="card-category"># of Schools</p>
                    <p id ="numSchools" class="card-title">420<p>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer ">
              <hr>
            
            </div>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title"> Start Scrape By Country</h4>
              </div>
              <div style="text-align:center;"class="card-body ml-auto mr-auto">
                  <button type="button" id ="btnCan" onclick="clickCanada()"  class="btn btn-primary btn-lg"> Canada </button>
                  <button type="button" id ="btnUS" onclick="clickUS()" class="btn btn-info btn-lg"> United States </button>
                  <button type="button" id ="btnUK" onclick="clickUK()" class="btn btn-success btn-lg"> United Kingdom </button>
                  <button type="button" id ="btnAus" onclick="clickAUS()" class="btn btn-danger btn-lg"> Australia </button>
                  <button type="button" id ="btnNZ" onclick="clickNZ()" class="btn btn-warning btn-lg"> New Zealand </button>

              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="content hide" id = "manualIntervention">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title"> Manual Intervention for Missing Information</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class=" text-primary">
                      <th>  </th>
                      <th> Profile Information </th>
                    </thead>
                    <tbody>
                      <tr>
                        <td class=" text-primary"> Name : </td>
                        <td id="ReviewName"> </td>
                      </tr>
                      <tr>
                        <td class=" text-primary"> Email : </td>
                        <td id="ReviewEmail"> </td>
                      </tr>
                      <tr>
                        <td class= "text-primary"> Institution : </td>
                        <td id="ReviewInsit">  </td>
                      </tr>
                      <tr>
                        <td class= "text-primary"> Country : </td>
                        <td id="ReviewCountry"> </td>
                      </tr>
                      <tr>
                        <td class= "text-primary"> Specialization(s) : </td>
                        <td id="ReviewSpec"> </td>
                      </tr>
                      <tr>
                        <td class= "text-primary"> Profile : </td>
                        <td id="ReviewProfile"> </td>
                      </tr>

 
                    </tbody>
                  </table>
                  <br>
<!--                   <h1 id = "total-count">  </h1>
                  <h1 id = "enter">  </h1> -->

                  <!-- <table class="table">
                    <tr>
                        <th> name</th>
                        <th> age </th>
                        <th> city</th>
                    </tr>
                    <tr>
                        <td id="testingname"> </td>
                        <td id="testingage"> </td>
                        <td id="testingcity"> </td>
                    </tr>
                    
                </table> -->
                </div>
                <br> <br>
                <form>
                    <h6 class="card-subtitle mb-2 text-muted"> Add The Missing Infomation </h6>
                    <!-- <input rows="1" id="myText" placeholder="enter missing information" class="form-control textarea"> </input> -->
                    <div >
                      <input  size="50" id="textName" placeholder="Enter missing name" > </input>  <br>
                      <input  size="50" id="textEmail" placeholder="Enter missing email"> </input>  <br>
                      <input size="50" id="textSpec" placeholder="Enter missing specialization(s)"> </input>  <br>
                      <!-- <input size="50" id="textSpec" placeholder="Enter missing specialization(s)" class="hide"> </input>  <br> -->

                    </div>

                    
                  
                </form>
                <div style="text-align: center;">
                  <button type="button" style="margin-right: 10px;" onclick="updateButton()" class="btn btn-primary btn-round btn-lg">Update Profile</button>
                  <button  type="button" style="margin-left: 10px;" onclick="skipButton()" class="btn btn-danger btn-round btn-lg">Skip This Profile</button>
                  <!-- <button  type="button" style="margin-left: 10px;" onclick="something()" class="btn btn-danger btn-round btn-lg">Testing Something</button> -->

                </div>
              </div>
               <!-- <button type="submit" class="btn btn-primary btn-round" onclick="window.open('helloworld.txt')">Download!</button> -->



              
            </div>            
            </div>
          </div>
        </div>
        <div style = "text-align: center; width: 200px;" class = "ml-auto mr-auto">
          <button type="button" id="btnDownload" onclick = "download()" class="btn btn-lg btn-primary">Download</button>
        </div>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="./assets/js/core/jquery.min.js"></script>
  <script src="./assets/js/core/popper.min.js"></script>
  <script src="./assets/js/core/bootstrap.min.js"></script>
  <script src="./assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@5.0.0/bundles/stomp.umd.min.js"></script> <!-- stomper-->
  <!-- Chart JS -->
  <script src="./assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="./assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="./assets/js/paper-dashboard.min.js?v=2.0.1" type="text/javascript"></script>
  <!-- <script type="text/javascript" src="renderjson.js"></script> -->


  <script>
    const client = new StompJs.Client({
        brokerURL: 'ws://localhost:8080/manual-intervention-websocket', //XHANGEAD TOOOO 80000 LATER
        debug: function (str) {
            console.log(str);
        },
        reconnectDelay: 5000,
        heartbeatIncoming: 4000,
        heartbeatOutgoing: 4000,
    });

    callback = function (message) {
      // called when the client receives a STOMP message from the server
      if (message.body) {
        alert('got message with body ' + message.body);
      } else {
        alert('got empty message');
      }
    }; 

    client.onConnect = function (frame) {
    // Do something, all subscribes must be done is this callback
    // This is needed because this will be executed after a (re)connect
        const subscription = client.subscribe('/data/incompleteScrape', callback);
        //console.log("hello world");
    };

    client.activate();



     const myJson = `[
        {
          "reviewer": {
              "name": null,
              "salutation": "Dr.",
              "email": "aaa@queensu.ca",
              "institution": {
                  "name": "Queen's University",
                  "country": "Canada",
                  "address": "99 University Ave, Kingston, ON, K7L 3N6",
                  "website": "https://www.queensu.ca/philosophy/people/faculty-and-fellows"
              },
              "department": null,
              "specializations": null
          },
          "profile": {
              "url": "https://www.queensu.ca/philosophy/people/daryn-lehoux"
          },
          "specializations": [],
          "missing": ["NAME","SPECS"]

        },
        {

          "reviewer": {
              "name": "B",
              "salutation": "Dr.",
              "email": " ",
              "institution": {
                  "name": "Queen's University",
                  "country": "Canada",
                  "address": "99 University Ave, Kingston, ON, K7L 3N6",
                  "website": "https://www.queensu.ca/philosophy/people/faculty-and-fellows"
              },
              "department": null,
              "specializations": ["philosophy of mind", "behavioral philosophy"]
          },
          "profile": {
              "url": "https://www.queensu.ca/philosophy/people/daryn-lehoux"
          },
          "missing": ["EMAIL"]

        },
        {
          "reviewer": {
              "name": "   ",
              "salutation": "Dr.",
              "email": " ",
              "institution": {
                  "name": "Queen's University",
                  "country": "Canada",
                  "address": "99 University Ave, Kingston, ON, K7L 3N6",
                  "website": "https://www.queensu.ca/philosophy/people/faculty-and-fellows"
              },
              "department": null,
              "specializations": null
          },
          "profile": {
              "url": "https://www.queensu.ca/philosophy/people/daryn-lehoux"
          },
          "missing": ["EMAIL","SPECS", "NAME"]
        }
    ]`;
    

    //var obj = JSON.parse(myJson);

    const increaseCount = document.getElementById("increment-count");

    //const totalCount = document.getElementById("total-count");
    
    let count = 0;
    var txt = JSON.parse(myJson);
    var skipcount = 0;
    var updateCount = 0;
  

    document.getElementById("ReviewName").innerHTML =  txt[0].reviewer.name; 
      document.getElementById("ReviewEmail").innerHTML =  txt[0].reviewer.email; 
      document.getElementById("ReviewInsit").innerHTML =  txt[0].reviewer.institution.name; 
      document.getElementById("ReviewCountry").innerHTML =  txt[0].reviewer.institution.country; 
      document.getElementById("ReviewSpec").innerHTML =  txt[0].reviewer.specializations; 
      document.getElementById("ReviewProfile").innerHTML =  txt[0].profile.url; 

    function next () {
      count++;

        document.getElementById("ReviewName").innerHTML =  txt[count].reviewer.name; 
        document.getElementById("ReviewEmail").innerHTML =  txt[count].reviewer.email; 
        document.getElementById("ReviewInsit").innerHTML =  txt[count].reviewer.institution.name; 
        document.getElementById("ReviewCountry").innerHTML =  txt[count].reviewer.institution.country; 
        document.getElementById("ReviewSpec").innerHTML =  txt[count].reviewer.specializations; 
        document.getElementById("ReviewProfile").innerHTML =  txt[count].profile.url; 

        // document.getElementById("numSkip").innerHTML = skipcount;

    }

    function skipButton () {
      skipcount++;
      next();
    }

    function updateButton () { 
      var currCountry = txt[count].reviewer.institution.country;
      var currInst = txt[count].reviewer.institution.name;
      var currAdd = txt[count].reviewer.institution.address;
      var currWeb = txt[count].profile.url;
      var currDept = txt[count].reviewer.department;

      updateProfile(currCountry,currInst, currAdd, currWeb, currDept);
      next();

    }

    function updateProfile (currCountry, currInst, currAdd, currWeb, currDept) {
      //document.getElementById("numUpdate") = updateCount;
      const quote = `{
        "name": " asdf",
        "salutation": "Dr",
        "email": " ",
        "institution": {
          "name": " ",
          "country": " asdfasdfasdf",
          "address": " asdfadf",
          "website": " "
        },
        "department": "temp",
        "specializations": [ ]
      }`;

      var quo = JSON.parse(quote);


        // Add the items that are the same from the input to the output
  /*      quo.institution.name = obj["reviewer"]["institution"]["name"];
       quo.institution.country = obj["reviewer"]["institution"]["country"];
       quo.institution.address = obj["reviewer"]["institution"]["address"];
       quo.institution.website = obj["reviewer"]["institution"]["website"];
       quo.department = obj["reviewer"]["department"];  */

      var typedName = document.getElementById("textName");
      var typedInsit = document.getElementById("textEmail");
      var typedEmail = document.getElementById("textSpec");

    
      quo.name = typedName.value;
      quo.email = typedName.value;
      quo.specializations = typedEmail.value;
      quo.institution.country = currCountry;
      quo.institution.address = currCountry;
      quo.institution.website = currCountry;
      quo.department = currCountry;



      client.publish({ destination: '/app/complete', body: JSON.stringify(quo) });   
      
      // Reset the Textbox
      document.getElementById("textName").value=null;
      document.getElementById("textEmail").value=null;
      document.getElementById("textSpec").value=null;
    }

  
    increaseCount.addEventListener("click", handleIncrement);
    //document.getElementById("print").innerHTML = txt[1]["name"];


     // Create a empty JSON that will be the output    
    var temp = obj["reviewer"]["name"];
    var output = `{
      "name": " ",
      "salutation": "Dr",
      "email": " ",
      "institution": {
        "name": " ",
        "country": " ",
        "address": " ",
        "website": " "
      },
      "department": "temp",
      "specializations": [ ]
    }`;
    var parseOP = JSON.parse(output);

    function something () {
      console.log('quote:', quote);
      console.log('stringified quote:', JSON.stringify(quote));
      client.publish({ destination: '/app/complete', body: JSON.stringify(quote) });    
    }

    

     // Add the items that are the same from the input to the output
/*     parseOP.institution.name = obj["reviewer"]["institution"]["name"];
    parseOP.institution.country = obj["reviewer"]["institution"]["country"];
    parseOP.institution.address = obj["reviewer"]["institution"]["address"];
    parseOP.institution.website = obj["reviewer"]["institution"]["website"];
    parseOP.department = obj["reviewer"]["department"];  */



              

    // document.getElementById("print").innerHTML = "New !";
    // document.getElementById("print").innerHTML = obj["missing"];
    // if (obj["missing"].includes("EMAIL")){
    //   document.getElementById("print").innerHTML = "New !";
    // }
    // document.getElementById("print").innerHTML = parseOP["department"];


    document.getElementById("ReviewName").innerHTML = obj["reviewer"]["name"]; // Add 
    document.getElementById("ReviewEmail").innerHTML = obj["reviewer"]["email"]; // Add 
    document.getElementById("ReviewInsit").innerHTML = obj["reviewer"]["institution"]["name"]; // Display the insitution name
    document.getElementById("ReviewCountry").innerHTML = obj["reviewer"]["institution"]["country"]; // Display the insitution country
    document.getElementById("ReviewSpec").innerHTML = obj["reviewer"]["specializations"] + ", &nbsp;";
    document.getElementById("ReviewProfile").innerHTML = obj["profile"]["url"]; // Display the profile url 
    
    var timerFlag = true;

    async function clickCanada() {
      //startClock ();
      var text = document.getElementById("manualIntervention");
      text.classList.add("show"); 
      try {     
            const response = await fetch('/ca/start', {
            method: 'post',
            body: {
                // Your body
                // dont need body
            }
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }

    }

    async function clickAUS() {
      var text = document.getElementById("manualIntervention");
      text.classList.add("show"); 
      try {     
            const response = await fetch('/au/start', {
            method: 'post',
            body: {
                // Your body
                // dont need body
            }
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }
    }

    async function clickNZ() {
      var text = document.getElementById("manualIntervention");
      text.classList.add("show"); 
        try {     
            const response = await fetch('/nz/start', {
            method: 'post',
            body: {
                // Your body
                // dont need body
            }
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }
    }
    async function clickUS() {
      var text = document.getElementById("manualIntervention");
      text.classList.add("show"); 
        try {     
            const response = await fetch('/us/start', {
            method: 'post',
            body: {
                // Your body
                // dont need body
            }
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }
    }
    async function clickUK() {
      var text = document.getElementById("manualIntervention");
      text.classList.add("show"); 
        try {     
            const response = await fetch('/uk/start', {
            method: 'post',
            body: {
                // Your body
                // dont need body
            }
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }
    }



    
    //parseOP.specializations = obj["reviewer"]["lastName"];


    // document.getElementById("print").innerHTML = parseOP["email"];



    function startClock () {    
      // Start Clock
      var start = new Date().getTime();
      // Update the count down every 1 second
      var x = setInterval(function() {

      // Get today's date and time
      var now = new Date().getTime();
        
      // Find the distance between now and the count down date
      var distance =  now - start;
        
      // Time calculations for days, hours, minutes and seconds

      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
      // Output the result in an element with id="demo"
      document.getElementById("timer").innerHTML = minutes + "m" + seconds + "s";
        
      // If the count down is over, write some text 
      if (distance < 0) {
        clearInterval(x);
        document.getElementById("timer").innerHTML = "EXPIRED";
      }
      }, 1000);
    }

    async function download () {
      try {     
            const response = await fetch('/export', {
            method: 'get'
            });
            console.log('Completed!', response);
        } catch(err) {
            console.error(`Error: ${err}`);
        }
    }

    </script>

</body>

</html>
